import { CcLrcController, CcLyricView, Lrc, LrcLine, LrcWord } from '@seagazer/cclyric';

const src1 = [
    "[ar:G.E.M. 邓紫棋、张靓颖]",
    "[ti:雨蝶 (Live)]",
    "[offset:0]",
    "[tool:LDDC v0.9.2 https://github.com/chenmozhijin/LDDC]",
    "[00:00.000]G[00:00.178].[00:00.356]E[00:00.534].[00:00.713]M[00:00.891].[00:01.069] [00:01.248]邓[00:01.426]紫[00:01.604]棋[00:01.783]、[00:01.961]张[00:02.139]靓[00:02.318]颖[00:02.496] [00:02.674]-[00:02.853] [00:03.031]雨[00:03.209]蝶[00:03.388] [00:03.566]([00:03.744]L[00:03.923]i[00:04.101]v[00:04.279]e[00:04.457])[00:04.636]",
    "[00:04.636]作[00:04.814]词[00:04.992]：[00:05.171]许[00:05.349]常[00:05.527]德[00:05.706]、[00:05.884]琼[00:06.062]瑶[00:06.241]",
    "[00:06.241]作[00:06.419]曲[00:06.597]：[00:06.776]张[00:06.954]宇[00:07.132]",
    "[00:07.132]原[00:07.311]唱[00:07.489]：[00:07.667]李[00:07.846]翊[00:08.024]君[00:08.202]",
    "[00:08.202]音[00:08.380]乐[00:08.559]总[00:08.737]监[00:08.915]：[00:09.094]楼[00:09.272]恩[00:09.450]奇[00:09.629]",
    "[00:09.629]定[00:09.807]位[00:09.985]制[00:10.164]作[00:10.342]人[00:10.520]：[00:10.699]刘[00:10.877]洲[00:11.055]",
    "[00:11.055]编[00:11.234]曲[00:11.412]：[00:11.590]宋[00:11.768]阳[00:11.947]",
    "[00:11.947]吉[00:12.125]他[00:12.303]：[00:12.482]王[00:12.660]传[00:12.838]统[00:13.017]",
    "[00:13.017]弦[00:13.195]乐[00:13.373]：[00:13.552]国[00:13.730]际[00:13.908]首[00:14.087]席[00:14.265]爱[00:14.443]乐[00:14.622]乐[00:14.800]团[00:14.978]",
    "[00:14.978]张[00:15.157]靓[00:15.335]颖[00:15.513]：[00:15.691]",
    "[00:15.692]爱[00:16.272]到[00:16.552]心[00:17.222]破[00:17.502]碎[00:18.212]也[00:18.492]别[00:18.842]去[00:19.152]怪[00:19.462]谁[00:20.052]",
    "[00:20.072]只[00:20.452]因[00:20.832]为[00:20.992]相[00:21.492]遇[00:21.982]太[00:22.382]美[00:22.752]",
    "[00:23.592]就[00:23.922]算[00:24.292]流[00:24.642]干[00:24.972]泪[00:25.202]伤[00:25.612]到[00:25.912]底[00:26.122]",
    "[00:26.142]心[00:26.542]成[00:26.872]灰[00:27.252]也[00:27.482]无[00:27.792]所[00:28.262]谓[00:29.322]",
    "[00:30.822]我[00:31.632]破[00:31.992]茧[00:32.712]成[00:33.112]蝶[00:33.682]愿[00:34.012]和[00:34.362]你[00:34.572]双[00:34.992]飞[00:35.322]",
    "[00:35.582]最[00:35.912]怕[00:36.312]你[00:36.602]会[00:37.042]一[00:37.162]去[00:37.562]不[00:37.912]回[00:38.492]",
    "[00:39.112]虽[00:39.492]然[00:39.862]爱[00:40.122]过[00:40.572]我[00:40.742]给[00:41.082]过[00:41.442]我[00:41.612]",
    "[00:41.632]想[00:42.092]过[00:42.422]我[00:42.642]就[00:42.962]是[00:43.402]安[00:43.682]慰[00:44.952]",
    "[00:46.462]我[00:46.802]向[00:47.302]你[00:47.562]飞[00:48.402]雨[00:48.522]温[00:48.842]柔[00:49.142]的[00:49.372]坠[00:49.922]",
    "[00:50.312]像[00:50.772]你[00:51.072]的[00:51.442]拥[00:52.052]抱[00:52.392]把[00:52.782]我[00:53.032]包[00:53.362]围[00:53.842]",
    "[00:54.152]我[00:54.432]向[00:54.942]你[00:55.152]飞[00:55.892]多[00:56.242]远[00:56.582]都[00:56.872]不[00:57.262]累[00:57.632]",
    "[00:57.832]虽[00:58.232]然[00:58.602]旅[00:58.872]途[00:59.182]中[00:59.812]有[01:00.142]过[01:00.472]痛[01:00.832]和[01:01.172]泪[01:01.612]",
    "[01:01.892]我[01:02.302]向[01:02.782]你[01:03.032]追[01:03.692]风[01:04.032]温[01:04.362]柔[01:04.662]的[01:04.892]吹[01:05.412]",
    "[01:05.872]只[01:06.312]要[01:06.632]你[01:07.042]无[01:07.562]怨[01:07.932]我[01:08.272]也[01:08.572]无[01:08.892]悔[01:09.362]",
    "[01:09.792]爱[01:10.022]是[01:10.482]那[01:10.792]么[01:11.442]美[01:11.752]我[01:12.042]心[01:12.412]陶[01:12.722]醉[01:13.182]",
    "[01:13.412]被[01:13.832]爱[01:14.352]的[01:14.662]感[01:15.092]觉[01:17.892]",
    "[01:17.892]G[01:18.440].[01:18.989]E[01:19.538].[01:20.087]M[01:20.636].[01:21.185] [01:21.734]邓[01:22.283]紫[01:22.832]棋[01:23.381]：[01:23.929]",
    "[01:49.033]爱[01:49.235]到[01:49.492]心[01:50.106]破[01:50.410]碎[01:51.121]也[01:51.427]别[01:51.730]去[01:52.035]怪[01:52.389]谁[01:52.543]",
    "[01:52.940]只[01:53.380]因[01:53.680]为[01:53.890]相[01:54.380]遇[01:54.810]太[01:55.250]美[01:55.840]",
    "[01:56.530]就[01:56.780]算[01:57.190]流[01:57.540]干[01:57.860]泪[01:58.080]伤[01:58.510]到[01:58.830]底[01:59.010]",
    "[01:59.030]心[01:59.470]成[01:59.800]灰[02:00.130]也[02:00.500]无[02:00.630]所[02:01.080]谓[02:02.090]",
    "[02:04.296]我[02:04.606]破[02:04.886]茧[02:05.506]成[02:05.936]蝶[02:06.586]愿[02:06.906]和[02:07.216]你[02:07.416]双[02:07.816]飞[02:08.216]",
    "[02:08.476]最[02:08.826]怕[02:09.156]你[02:09.476]会[02:09.996]一[02:10.016]去[02:10.406]不[02:10.756]回[02:11.186]",
    "[02:11.996]虽[02:12.366]然[02:12.786]爱[02:13.036]过[02:13.376]我[02:13.646]给[02:13.996]过[02:14.336]我[02:14.486]",
    "[02:14.506]想[02:14.956]过[02:15.306]我[02:15.576]就[02:15.886]是[02:16.306]安[02:16.576]慰[02:18.576]",
    "[02:19.486]我[02:19.656]向[02:20.126]你[02:20.386]飞[02:21.306]雨[02:21.416]温[02:21.726]柔[02:22.076]的[02:22.286]坠[02:23.076]",
    "[02:23.256]像[02:23.676]你[02:23.996]的[02:24.296]拥[02:24.936]抱[02:25.286]把[02:25.676]我[02:25.906]包[02:26.256]围[02:26.876]",
    "[02:27.216]我[02:27.386]向[02:27.866]你[02:28.076]飞[02:28.766]多[02:29.146]远[02:29.466]都[02:29.806]不[02:30.086]累[02:30.516]",
    "[02:30.676]虽[02:31.086]然[02:31.426]旅[02:31.696]途[02:31.996]中[02:32.676]有[02:33.006]过[02:33.276]痛[02:33.726]和[02:33.956]泪[02:34.736]",
    "[02:34.946]我[02:35.166]向[02:35.626]你[02:35.876]追[02:36.566]风[02:36.926]温[02:37.206]柔[02:37.556]的[02:37.756]吹[02:38.536]",
    "[02:38.756]只[02:39.166]要[02:39.446]你[02:39.836]无[02:40.436]怨[02:40.756]我[02:41.106]也[02:41.606]无[02:41.676]悔[02:42.416]",
    "[02:42.716]爱[02:42.916]是[02:43.326]那[02:43.656]么[02:44.276]美[02:44.646]我[02:44.846]心[02:45.256]陶[02:45.546]醉[02:46.016]",
    "[02:46.216]被[02:46.626]爱[02:46.896]的[02:47.206]感[02:47.496]觉[02:50.466]",
    "[02:50.466]张[02:58.206]靓[03:05.946]颖[03:13.686]：[03:21.426]",
    "[03:21.426]我[03:21.586]向[03:22.116]你[03:22.326]飞[03:23.136]雨[03:23.366]温[03:23.756]柔[03:24.066]的[03:24.296]坠[03:24.796]",
    "[03:25.156]像[03:25.656]你[03:25.936]的[03:26.296]拥[03:26.946]抱[03:27.256]把[03:27.666]我[03:27.926]包[03:28.296]围[03:28.986]",
    "[03:28.986]G[03:29.004].[03:29.022]E[03:29.040].[03:29.058]M[03:29.076].[03:29.095] [03:29.113]邓[03:29.131]紫[03:29.149]棋[03:29.167]：[03:29.185]",
    "[03:29.186]我[03:29.406]向[03:29.846]你[03:30.026]飞[03:30.736]多[03:31.106]远[03:31.416]都[03:31.696]不[03:32.096]累[03:32.466]",
    "[03:32.596]虽[03:33.036]然[03:33.386]旅[03:33.666]途[03:33.956]中[03:34.576]有[03:34.936]过[03:35.206]痛[03:35.596]和[03:35.896]泪[03:36.686]",
    "[03:36.686]合[03:36.786]：[03:36.886]",
    "[03:36.886]我[03:37.096]向[03:37.536]你[03:37.806]追[03:38.526]风[03:38.856]温[03:39.156]柔[03:39.476]的[03:39.716]吹[03:40.426]",
    "[03:40.706]只[03:41.106]要[03:41.396]你[03:41.796]无[03:42.376]怨[03:42.716]我[03:43.066]也[03:43.606]无[03:43.696]悔[03:44.356]",
    "[03:44.656]爱[03:44.816]是[03:45.266]那[03:45.596]么[03:46.216]美[03:46.586]我[03:46.796]心[03:47.196]陶[03:47.486]醉[03:47.916]",
    "[03:48.103]被[03:48.358]爱[03:48.869]的[03:49.225]感[03:49.531]觉[03:49.888]",
    "[03:52.228]被[03:52.484]爱[03:52.840]的[03:53.609]感[03:53.861]觉[03:54.115]",
    "[03:56.234]被[03:56.488]爱[03:56.743]的[03:57.046]感[03:57.300]觉[03:57.553]",
]

const src2: string[] = [
    "[ar:程响]",
    "[ti:可能]",
    "[offset:0]",
    "[00:00.099]程[00:00.288]响 [00:00.502]- [00:00.645]可[00:00.858]能[00:01.072]",
    "[00:01.072]作[00:01.287]词[00:01.499]Lyricist：[00:01.643]宁[00:01.856]缺[00:02.072]",
    "[00:02.072]作[00:02.215]曲[00:02.428]Composer：[00:02.572]宁[00:02.785]缺[00:02.927]",
    "[00:02.927]编[00:03.140]曲[00:03.354]Arranger：[00:03.569]曲[00:03.784]比[00:03.928]阿[00:04.141]且[00:04.354]",
    "[00:04.354]录[00:04.851]音[00:05.064]Recording：[00:05.278]张[00:05.492]雨[00:05.705]农[00:05.847]",
    "[00:05.847]混[00:06.060]音[00:06.273]Mixing：[00:06.488]王[00:06.702]朋[00:06.915]",
    "[00:06.915]母[00:07.128]带[00:07.340]Master [00:07.624]tape：[00:07.837]全[00:07.979]相[00:08.264]彦[00:08.478]",
    "[00:26.846]可[00:27.275]能[00:27.630]南[00:27.915]方[00:28.489]的[00:28.774]阳[00:29.126]光 [00:29.481]照[00:29.767]着[00:30.051]北[00:30.408]方[00:30.907]的[00:31.264]风[00:31.834]",
    "[00:31.834]可[00:32.121]能[00:32.474]时[00:32.759]光[00:33.629]被[00:33.915]吹[00:34.198]走 [00:34.481]从[00:34.765]此[00:35.048]无[00:35.334]影[00:35.832]无[00:36.116]踪[00:36.760]",
    "[00:36.760]可[00:37.045]能[00:37.330]故[00:37.616]事[00:38.184]只[00:38.469]剩[00:38.825]下 [00:39.107]一[00:39.391]个[00:39.747]难[00:40.029]忘[00:40.599]的[00:40.956]人[00:41.451]",
    "[00:41.451]可[00:41.807]能[00:42.091]在[00:42.446]昨[00:42.730]夜[00:43.298]梦[00:43.654]里 [00:44.011]依[00:44.367]然[00:44.722]笑[00:45.150]得[00:45.577]纯[00:45.934]真[00:47.002]",
    "[00:48.922]可[00:49.279]能[00:49.633]北[00:49.995]京[00:50.494]的[00:50.779]后[00:51.062]海 [00:51.415]许[00:51.700]多[00:51.987]漂[00:52.415]泊[00:52.912]的[00:53.270]魂[00:53.483]",
    "[00:54.225]可[00:54.508]能[00:54.722]成[00:55.007]都[00:55.505]小[00:55.787]酒[00:56.072]馆 [00:56.357]有[00:56.642]群[00:57.000]孤[00:57.355]独[00:57.853]的[00:58.211]人[00:58.711]",
    "[00:58.711]可[00:59.065]能[00:59.351]枕[00:59.706]边[01:00.205]有[01:00.488]微[01:00.847]笑 [01:01.201]才[01:01.558]能[01:01.911]暖[01:02.269]你[01:02.767]清[01:03.119]晨[01:03.546]",
    "[01:03.546]可[01:03.906]能[01:04.189]夜[01:04.615]空[01:04.975]有[01:05.403]流[01:05.832]星 [01:06.261]才[01:06.545]能[01:06.828]照[01:07.257]你[01:07.611]前[01:07.966]行[01:09.106]",
    "[01:11.045]可[01:11.403]能[01:11.686]西[01:11.973]安[01:12.542]城[01:12.824]墙[01:13.035]上 [01:13.392]有[01:13.676]人[01:14.032]誓[01:14.386]言[01:14.882]不[01:15.239]分[01:15.735]",
    "[01:15.735]可[01:16.093]能[01:16.446]要[01:16.802]去[01:17.370]到[01:17.727]大[01:18.085]理 [01:18.370]才[01:18.655]算[01:19.012]爱[01:19.369]得[01:19.866]认[01:20.222]真[01:20.721]",
    "[01:20.721]可[01:21.004]能[01:21.287]谁[01:21.645]说[01:22.215]要[01:22.572]陪[01:22.926]你 [01:23.283]牵[01:23.565]手[01:23.921]走[01:24.276]完[01:24.772]一[01:25.129]生[01:25.628]",
    "[01:25.628]可[01:25.982]能[01:26.337]笑[01:26.693]着[01:27.120]流[01:27.547]出[01:27.904]泪 [01:30.605]某[01:31.101]天[01:31.315]在[01:31.743]某[01:32.028]时[01:32.457]辰[01:34.669]",
    "[01:55.246]可[01:55.531]能[01:55.817]桂[01:56.101]林[01:56.599]有[01:56.882]渔[01:57.240]船 [01:57.597]为[01:57.808]你[01:58.164]迷[01:58.518]茫[01:58.947]点[01:59.303]灯[01:59.803]",
    "[01:59.803]可[02:00.160]能[02:00.520]在[02:00.804]呼[02:01.445]伦[02:01.799]草[02:02.084]原 [02:02.439]牛[02:02.725]羊[02:03.080]流[02:03.507]成[02:03.933]风[02:04.285]景[02:04.856]",
    "[02:04.856]可[02:05.141]能[02:05.497]再[02:05.783]也[02:06.353]找[02:06.707]不[02:07.064]到 [02:07.350]愿[02:07.635]意[02:07.919]相[02:08.203]信[02:08.771]的[02:09.203]人[02:09.702]",
    "[02:09.702]可[02:09.985]能[02:10.341]穿[02:10.696]越[02:11.194]了[02:11.549]彷[02:11.906]徨 [02:12.261]脚[02:12.543]步[02:12.901]才[02:13.254]能[02:13.685]坚[02:14.040]定[02:15.322]",
    "[02:17.075]可[02:17.360]能[02:17.715]武[02:18.071]当[02:18.569]山[02:18.854]道[02:19.137]上 [02:19.492]有[02:19.777]人[02:20.059]虔[02:20.347]诚[02:20.631]攀[02:21.198]登[02:21.556]",
    "[02:22.230]可[02:22.513]能[02:22.796]周[02:23.079]庄[02:23.578]小[02:23.864]巷[02:24.148]里 [02:24.505]忽[02:24.864]然[02:25.218]忘[02:25.574]掉[02:26.069]年[02:26.351]轮[02:26.919]",
    "[02:26.919]可[02:27.203]能[02:27.630]要[02:27.913]多[02:28.482]年[02:28.768]以[02:29.054]后 [02:29.408]才[02:29.692]能[02:30.047]看[02:30.473]清[02:30.896]曾[02:31.250]经[02:31.752]",
    "[02:31.752]可[02:32.105]能[02:32.460]在[02:32.814]当[02:33.385]时[02:33.671]身[02:33.956]边 [02:34.312]有[02:34.666]双[02:35.022]温[02:35.376]柔[02:35.803]眼[02:36.231]睛[02:38.209]",
    "[02:39.116]可[02:39.540]能[02:39.897]西[02:40.184]安[02:40.610]城[02:40.965]墙[02:41.179]上 [02:41.464]有[02:41.819]人[02:42.100]誓[02:42.458]言[02:43.027]不[02:43.382]分[02:43.952]",
    "[02:43.952]可[02:44.306]能[02:44.662]要[02:45.018]去[02:45.590]到[02:45.942]大[02:46.225]理 [02:46.582]才[02:46.936]算[02:47.295]爱[02:47.724]得[02:48.151]认[02:48.435]真[02:48.934]",
    "[02:48.934]可[02:49.221]能[02:49.507]谁[02:49.862]说[02:50.432]要[02:50.719]陪[02:51.075]你 [02:51.499]牵[02:51.783]手[02:52.139]走[02:52.495]完[02:52.995]一[02:53.349]生[02:53.781]",
    "[02:53.781]可[02:54.069]能[02:54.423]笑[02:54.781]着[02:55.133]流[02:55.491]出[02:55.922]泪[02:58.693]",
    "[02:58.693]可[02:58.978]能[02:59.333]终[02:59.760]于[03:00.259]有[03:00.684]一[03:00.970]天 [03:01.258]刚[03:01.614]好[03:01.969]遇[03:02.325]见[03:02.749]爱[03:03.105]情[03:03.677]",
    "[03:03.677]可[03:03.961]能[03:04.320]永[03:04.675]远[03:05.174]在[03:05.529]路[03:05.885]上 [03:06.239]有[03:06.596]人[03:06.951]奋[03:07.235]斗[03:07.661]前[03:08.016]行[03:08.583]",
    "[03:08.583]可[03:08.868]能[03:09.223]一[03:09.579]切[03:10.083]的[03:10.439]可[03:10.724]能 [03:11.081]相[03:11.438]信[03:11.721]才[03:12.006]有[03:12.573]可[03:12.930]能[03:13.501]",
    "[03:13.501]可[03:13.786]能[03:14.142]拥[03:14.499]有[03:14.995]过[03:15.350]梦[03:15.711]想 [03:18.416]才[03:18.700]能[03:18.985]叫[03:19.488]做[03:19.916]青[03:20.271]春[03:22.337]"
];

class SampleLyricParser {
    parse(lyricLines: string[]): Lrc {
        const lyric: Lrc = {
            lyricList: []
        };
        let offset = 0; // 偏移量，默认0ms
        // 解析元数据和歌词行
        for (const line of lyricLines) {
            // 匹配元数据行（如[ar:阿桑]、[ti:一直很安静]等）
            const metaMatch = line.match(/^\[(ar|ti|al|by|offset):(.*)\]$/);
            if (metaMatch) {
                // const [, key, value] = metaMatch;
                const key = metaMatch[1]
                const value = metaMatch[2]
                switch (key) {
                    case 'ar':
                        lyric.artist = value.trim();
                        break;
                    case 'ti':
                        lyric.title = value.trim();
                        break;
                    case 'al':
                        lyric.album = value.trim();
                        break;
                    case 'by':
                        lyric.by = value.trim();
                        break;
                    case 'offset':
                        offset = parseInt(value.trim(), 10) || 0;
                        lyric.offset = offset;
                        break;
                }
                continue; // 处理完元数据，继续下一行
            }
            // 解析歌词行（带时间标签的行）
            // 分割时间标签和字符（例如[00:00.195]阿 → 分割为时间和字符）
            const parts = line.split(/\[(\d+:\d+\.\d+)\]/);
            const times: number[] = []; // 时间数组（毫秒）
            const chars: string[] = []; // 字符数组
            // 提取时间（索引1,3,5...）并转换为毫秒
            for (let i = 1; i < parts.length; i += 2) {
                const timeStr = parts[i];
                const split1 = timeStr.split(':');
                const mmStr = split1[0];
                const ssPart = split1[1];
                if (!ssPart) {
                    continue
                }
                // 无效格式跳过
                const split2 = ssPart.split('.');
                const ssStr = split2[0];
                const sssStr = split2[1];
                if (!sssStr) {
                    continue
                }
                // 无效格式跳过
                const mm = parseInt(mmStr, 10) || 0;
                const ss = parseInt(ssStr, 10) || 0;
                const sss = parseInt(sssStr, 10) || 0;
                const ms = mm * 60 * 1000 + ss * 1000 + sss;
                times.push(ms + offset); // 加上偏移量
            }
            // 提取字符（索引2,4,6...）
            for (let i = 2; i < parts.length; i += 2) {
                const char = parts[i].trim();
                if (char) {
                    chars.push(char);
                }
            }
            // 验证格式：时间数量应为字符数量+1（每个字符对应一个开始时间，最后一个时间是结束时间）
            if (times.length !== chars.length + 1) {
                continue
            }
            // 生成逐字歌词列表
            const wordList: LrcWord[] = chars.map((text, i) => {
                const data: LrcWord = {
                    text,
                    startTime: times[i],
                    endTime: times[i + 1]
                }
                return data
            });
            // 生成歌词行
            const lyricLine: LrcLine = {
                text: chars.join(''), // 行完整文本
                beginTime: times[0], // 行开始时间（第一个字符的开始时间）
                endTime: times[times.length - 1], // 行结束时间（最后一个字符的结束时间）
                wordList
            };
            lyric.lyricList.push(lyricLine);
        }
        return lyric;
    }
}

@Entry
@ComponentV2
struct Index2 {
    private timer = -1
    @Local focusIndex: number = -1
    @Local userSeekIndex: number = -1
    @Local progress: number = 0
    @Require @Param controller: CcLrcController = new CcLrcController()
    @Local lyric?: Lrc = undefined

    aboutToAppear(): void {
        // set controller
        this.controller.textSize = 18
        this.controller.lineSpace = 12
        this.controller.textColor = 0xCC000000
        this.controller.textHighlightColor = 0xffe7107f
        this.lyric = new SampleLyricParser().parse(src1)
        this.controller.lyric = this.lyric
    }

    @Builder
    FadeOverlay() {
        Column()
            .width("100%")
            .height("100%")
            .hitTestBehavior(HitTestMode.Transparent)
            .backgroundColor(Color.Transparent)
            .linearGradient({
                angle: 0,
                colors: [[this.controller.fadeColor, 0], ["#00ffffff", 0.2], ["#00ffffff", 0.8], [this.controller.fadeColor, 1]],
                repeating: false
            })
    }

    build() {
        Column() {
            Stack() {
                CcLyricView({
                    controller: this.controller
                })
            }
            .width("100%")
            .layoutWeight(1)

            Slider({
                value: this.progress,
                max: this.lyric ? this.lyric.lyricList[this.lyric.lyricList.length-1].endTime : 0
            }).width("100%").margin(8)
                .onChange((value, mode) => {
                    if (mode == SliderChangeMode.End) {
                        this.progress = value
                        this.controller.updatePosition(this.progress)
                    }
                })

            Row() {
                Button("start")
                    .onClick(() => {
                        this.mockPlayer()
                    })

                Button("change")
                    .onClick(() => {
                        this.mockChanged()
                    })
            }.width("100%")
            .justifyContent(FlexAlign.SpaceEvenly)
        }
        .height('100%')
        .width('100%')
    }

    private changeCount = 0

    private mockPlayer() {
        clearInterval(this.timer)
        this.progress = 0
        this.timer = setInterval(() => {
            this.progress += 300
            this.controller.updatePosition(this.progress)
        }, 300)
    }

    // change data source
    private mockChanged() {
        if (this.changeCount % 2 == 0) {
            this.controller.lyric = new SampleLyricParser().parse(src2)
            // replay
            this.mockPlayer()
        } else {
            this.controller.lyric = new SampleLyricParser().parse(src1)
            // replay
            this.mockPlayer()
        }
        this.changeCount++
    }
}







